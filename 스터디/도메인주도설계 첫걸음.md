
# 메모

- 회사의 핵심 비지니스는 높은 진입장벽이 있어야 한다.
- **비지니스 도메인** : 기업의 주요 활동 영역, 고객에게 제공하는 서비스
- **하위 도메인** : 고객에게 제공하는 서비스 단위
  - **핵심 하위 도메인 (핵심 도메인)**
    - 회사가 경쟁업체와 다르게 수행하고 있는 것
    - 하지만 반드시 기술이 들어가야 하는 것은 아님을 알아야 한다.
  - **일반 하위 도메인**
    - 모든 회사가 같은 방식으로 수행하는 비지니스 활동
    - 여전히 구현하기 복잡하고 어렵지만 회사에 경쟁력을 제공하지 않는다.
  - **지원 하위 도메인**
    - 어떠한 경쟁 우위도 제공하지 않으며, 비지니스 로직의 복잡성이 간단하다.
- 온라인에서 보석을 판매하는 제조업체라면, 보석 디자인은 핵심 하위 도메인이지만 온라인 쇼핑몰은 일반 하위 도메인이다.

# 유비쿼터스 언어

- 유비쿼터스 언어는 그저 커뮤니케이션시 같은 의미의 단어를 다른 형태로 혼란스럽게 사용하지 않게 도와주는 정도임
- 도메인 지식이 코드에 잘 전달되었는지를 확인할 방법은 제품을 도메인 측에서 사용해보는 수 밖에 없고 도메인 전문가가 해야할 핵심 업무임
- 유비쿼터스 그로서리를 가장 많이 사용하는 곳은 기획, QA임
- 따라서 실질적인 그로서리는 피그마 내부에서 정의되는 경우가 대부분

# 전략 패턴, 전술 패턴, 아키텍처

- **전략 패턴** : 디스틸레이션 (핵심, 일반, 지원), 컨텍스트 맵, 바운디드 컨텍스트
- **전술 패턴**
  - 표현 : association, entity, vo, service, module
  - 생명주기 : aggregate, repository, factory
- **아키텍처**
  - MSA가 뜨면서 헥사고날도 뜨고 DDD가 뜸
  - 이벤트소싱, CQRS
- **문제 공간과 솔루션 공간의 분리**
  - 문제공간 : 도메인을 분할할 것
  - 솔루션공간 : 바운디드 컨텍스트
  - 문제 공간을 솔루션 공간에 매핑함

# 바운디드 컨텍스트

- 이 코드를 두 팀이 관리하면 싸운다.
- 도메인이 같을지라도 심지어 하나의 애그리게이트로 파악되는 불변식이 있어도 일단 안싸우게 쪼개야 한다.
- 쪼개게 되면 중복이 발생하거나 도메인로직 상의 불일치나 정합성 위험이 생길 수 있다.
- 그렇다면 쪼개서 동기화 비용을 치루거나 수준을 낮춘 정합성을 사용하더라도 안싸우는게 더 득이되냐를 고민해야하나?

# 이벤트 소싱

- 실제 구현은 동기, 비동기 상황에 따라 매우 복잡함
- DDIA 이벤트 소싱편 참고
- **이벤트 소싱은 기본적으로 이벤트와 명령을 구분함**
  - 이벤트는 불변이고 이벤트 수신자는 거부할 수 없음
  - 이벤트는 생성 시점에 정합, 유효, 사실이어야 함
  - 수신자는 비동기 처리 가능, 생성자는 동기적 검증
  - 에를 들어, 예약 이벤트 발생 전 동기적인 좌석상태 검증이 필요하다. 이때 변경이나 취소는 또 다른 이벤트이다.

# 이벤트 스토어

- 이벤트 스토어의 운영을 CQRS의 다중 조회 모델에 맞출 수 있음
- 원본 이벤트 쓰기 전용 스토어
- 목적별 이벤트 뷰 스토어
- 문제는 2,3번 간의 동기화 시점임
  - 디비수준의 트랜잭션 보장레벨
  - 비동기 레벨
- 일반적으로 트랜잭션 레벨과 비동기 레벨을 둘 다 뷰목적에 맞춰 이용
- 이벤트는 불변이고 삭제되지 않기 때문에 여러 조회용 스토러를 만들어도 관리비용이 들지 않음

# CQRS

- 읽기 중심으로 사고할 것!
  - 단일 원본 쓰기가 다양한 읽기로 프로젝션됨
  - 읽기는 여러 원본으로부터 쉐이핑되고 프로젝션됨

# DDD 일관성

- **트랜잭션 일관성** : 애그리게이트 안쪽 - DB 트랜잭션 등 원자적 장치를 이용
- **이벤트 일관성** : 애그리게이트 외부 - 도메인 이벤트를 이용
- **사가 패턴** : 이벤트 일관성을 이용하며 이벤트를 로그로 쌓아서 처리
  - 결국 커맨드 패턴을 이용한 언두와 마찬가지 원리
  - 사가에 참가하는 애그리게이트는 사가용 이벤트를 발급할 때 상응하는 취소 처리를 정의할 수 있어야한다
  - 각 사가 이벤트 로그에 참가하는 애그리게이트가 자신의 이벤트 만큼 책임을 가져감
- **프로세스 관리자** : 관리자가 통제하고 취소처리는 각 애그리게이트가 한다.

***

- 몽고, 카산드라, 카프카 등 브로드캐스팅 방식으로 데이터 정합성을 지켜주는 솔루션이 있음