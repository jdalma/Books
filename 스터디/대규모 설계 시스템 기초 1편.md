
# 1장. 사용자 수에 따른 확장성

1. **비관계형 데이터베이스가 바람직한 경우**
   1. 아주 낮은 응답 지연시간이 요구됨
   2. 다루는 데이터가 비정형이라 관계형 데이터가 아님
   3. 데이터를 직렬화하거나 역직렬화 할 수 있기만 하면됨
   4. 아주 많은 양의 데이터를 저장할 필요가 있음
2. **로드밸런서**
   1. 웹 서버는 클라이언트의 접속을 직접 처리하지 않는다. 더 나은 보안을 위해, 로드밸런서와 서버 간 통신에는 사설 IP 주소가 이용된다.
   2. 웹 계층의 가용성을 보장할 수 있다.
   3. 고정 세션 (sticky session)
3. **데이터베이스 다중화와 샤딩(수평적 확장)**
   1. 샤딩 키(파티션 키) 전략에 대한 고민 : 유명인사 문제, 핫스팟 키 문제
   2. 샤딩을 적용한 후에 데이터가 샤드의 크기를 넘어간다면 재 샤딩에 대한 고려가 필요하다.
   3. 여러 샤드 간에는 데이터를 조인하기 힘들기 때문에 DB를 비정규화하여 하나의 테이블에서 질의가 수행될 수 있도록 하는 것도 방법이다.
4. **응답 시간 개선 방법**
   1. **캐시 계층**
      1. 읽기 주도형 캐시 전략 : 캐시 미스가 발생한다면 DB에서 데이터를 직접 찾아 저장한 뒤 클라이언트에게 반환한다.
      2. 캐시할 데이터 종류, 크기, 액세스 패턴에 맞는 캐시 전략을 선택해야 한다.
      3. 데이터 갱신은 자주 일어나지 않지만 참조는 자주 일어나는가?
      4. 영속적으로 보관하지 않아도 될 데이터인가?
      5. 만료 기간과 기준은 어떻게 정할 것인가?
      6. 데이터 일관성은 어떻게 제공할 것인가?
      7. 캐시 서버의 장애에 대한 대응은 어떻게 할 것인가?
      8. 캐시가 꽉 찼을 때 데이터 방출 정책은 무엇인가? (LRU, LFU)
   2. **콘텐츠 전송 네트워크 (CDN)**
      1. 사용자에게 가장 가까운 CDN 서버가 정적 컨텐츠를 제공하며, 만약 CDN 서버에 정적 컨텐츠가 없다면 원본 서버에 요청하여 응답한다.
      2. 컨텐츠에는 TTL이 지정되어 있다.
      3. CDN으로 들어가고 나가는 데이터 전송 양에 따라 요금을 낸다.
      4. 만료 시점을 잘 정해야 한다.
      5. 아직 만료되지 않은 컨텐츠라도 컨텐츠를 무효화할 수 있는 방법을 만들어 놓아야 한다.
5. **무상태 웹 계층**
   1. 스케일 아웃을 위해 웹 계층에는 사용자 세션 데이터와 같은 상태 정보가 존재해서는 안된다.

# 2장. 개략적인 규모 추정
1. [Latency Numbers Every Programmer Should Know](https://gist.github.com/jboner/2841832), [visualize](https://colin-scott.github.io/personal_website/research/interactive_latency.html)
2. QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 개략적으로 추정할 때는 딱 맞는 결과값 보다는 문제 해결 능력이 중요하다.

# 3장. 시스템 설계 면접 공략법

> 면접은 퀴즈 쇼가 아니며, 정답 따위는 없다는 걸 상기하자.

1. **1단계 : 문제 이해 및 설계 범위 확정**
   1. 엔지니어가 가져야 할 가장 중요한 기술 중 하나는 `올바른 질문`을 하는 것, `적절한 가정`을 하는 것, `시스템 구축에 필요한 정보를 모으는 것`이다.
2. **2단계 : 개략적인 설계안 제시 및 동의 구하기**
   1. 최초 청사진을 제시하고 의견을 구하라. 면접관을 마치 팀원인 것 처럼 대하라.
   2. 핵심 컴포넌트를 포함하는 다이어그램을 그려라.
3. **3단계 : 상세 설계**
   1. 시스템에서 전반적으로 달성해랴 할 목표와 기능 범위 확인
   2. 전체 설계의 개략적 청사진 마련
   3. 해당 청사진에 대한 면접관의 의견 청취
   4. 상세 설계에서 집중해야 할 영역들 확인
4. **4단계 : 마무리**
   1. 병목구간, 좀 더 개선 가능한 지점

# 4장. 처리율 제한 장치의 설계

1. 네트워크 시스템에서 처리율 제한 장치는 클라이언트 또는 서비스가 보내는 트래픽의 처리율을 제어하기 위한 장치다.
2. 예를 들어, 특정 기간 내에 전송되는 클라이언트의 HTTP 요청 횟수를 제한하여 횟수에 범어나는 요청은 처리하지 않는 것이다.
   1. 초당 2회 이상 새 글 작성 못함, 같은 IP 주소로는 하루에 10개 이상의 계정을 생성 못함, 같은 디바이스로는 주당 5회 이상 보상을 요청 못함
3. DoS 예방 방지 + 비용 절감 + 서버 과부하 방지
4. **처리율 제한 알고리즘**
   1. 토큰 버킷 : 각 요청은 처리될 때 마다 하나의 토큰을 사용하며, 일정 주기로 토큰을 보급한다.
   2. 누출 버킷 : 요청을 처리할 큐를 준비하여 큐의 사이즈만큼 처리한다. 큐가 다 차있다면 새로 들어온 요청은 버려진다.
   3. 고정 윈도 카운터 : 고정된 간격의 윈도(시간)동안 설정된 임계치에 도달하면 요청은 새 윈도가 열릴 때 까지 버려진다.
   4. 이동 윈도 로그 : 요청의 타임스탬프를 기준으로 판단한다.
   5. 이동 윈도 카운터


# 질문 목록

1. 지리적 라우팅(geoDNS)은 DNS 목록을 갱신하는 것인가? 장애가 없는 데이터 센터는 어떻게 알아낼 수 있나?